<!-- parking-edit/parking-edit.component.html -->

<div class="container-lg py-4">

  <!-- LOADING DATA -->
  @if (loadingData) {
    <div class="text-center py-5">
      <c-spinner color="primary"></c-spinner>
      <p class="text-muted mt-2">Cargando datos del parqueo...</p>
    </div>
  }

  <!-- CONTENIDO -->
  @if (!loadingData && parking) {

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-0">Editar Parqueo</h2>
        <small class="text-muted">{{ parking.name }}</small>
      </div>
      <button cButton color="secondary" variant="outline" (click)="onCancel()">
        <c-icon name="cilArrowLeft" class="me-2"></c-icon>
        Cancelar
      </button>
    </div>

    <!-- ERROR -->
    @if (errorMessage) {
      <c-alert color="danger" [dismissible]="true" (visibleChange)="errorMessage = ''">
        <c-icon name="cilWarning" class="me-2"></c-icon>{{ errorMessage }}
      </c-alert>
    }

    <!-- SUCCESS -->
    @if (successMessage) {
      <c-alert color="success" [dismissible]="false">
        <c-icon name="cilCheckCircle" class="me-2"></c-icon>{{ successMessage }}
      </c-alert>
    }

    <!-- FORMULARIO -->
    <c-card>
      <c-card-header>
        <strong>
          <c-icon name="cilPencil" class="me-2"></c-icon>
          Información General
        </strong>
      </c-card-header>

      <c-card-body>
        <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

          <!-- FILA 1: Nombre + Código -->
          <div cRow class="mb-3">
            <div cCol sm="8">
              <label cLabel for="name">Nombre del Parqueo <span class="text-danger">*</span></label>
              <input
                cFormControl
                id="name"
                type="text"
                formControlName="name"
                placeholder="Ej: Parqueo Simón Bolívar"
                [class.is-invalid]="isInvalid('name')"
              />
              @if (isInvalid('name')) {
                <c-form-feedback [valid]="false">{{ getError('name') }}</c-form-feedback>
              }
            </div>

            <div cCol sm="4">
              <label cLabel for="code">Código <span class="text-danger">*</span></label>
              <input
                cFormControl
                id="code"
                type="text"
                formControlName="code"
                placeholder="Ej: PSB"
                (input)="onCodeInput($event)"
                [class.is-invalid]="isInvalid('code')"
              />
              @if (isInvalid('code')) {
                <c-form-feedback [valid]="false">{{ getError('code') }}</c-form-feedback>
              }
              <div class="form-text">Solo mayúsculas, números y guiones.</div>
            </div>
          </div>

          <!-- FILA 2: Dirección -->
          <div cRow class="mb-3">
            <div cCol sm="12">
              <label cLabel for="address">Dirección <span class="text-danger">*</span></label>
              <input
                cFormControl
                id="address"
                type="text"
                formControlName="address"
                placeholder="Ej: Distrito de Huaraz, Ancash"
                [class.is-invalid]="isInvalid('address')"
              />
              @if (isInvalid('address')) {
                <c-form-feedback [valid]="false">{{ getError('address') }}</c-form-feedback>
              }
            </div>
          </div>

          <!-- FILA 3: Descripción -->
          <div cRow class="mb-3">
            <div cCol sm="12">
              <label cLabel for="description">Descripción</label>
              <textarea
                cFormControl
                id="description"
                formControlName="description"
                rows="3"
                placeholder="Descripción general del parqueo (opcional)"
                [class.is-invalid]="isInvalid('description')"
              ></textarea>
              @if (isInvalid('description')) {
                <c-form-feedback [valid]="false">{{ getError('description') }}</c-form-feedback>
              }
            </div>
          </div>

          <!-- FILA 4: Coordenadas GPS -->
          <div cRow class="mb-3">
            <div cCol sm="6">
              <label cLabel for="latitude">Latitud GPS</label>
              <input
                cFormControl
                id="latitude"
                type="number"
                formControlName="latitude"
                placeholder="Ej: -9.5277"
                step="0.0001"
                [class.is-invalid]="isInvalid('latitude')"
              />
              @if (isInvalid('latitude')) {
                <c-form-feedback [valid]="false">{{ getError('latitude') }}</c-form-feedback>
              }
              <div class="form-text">Rango: -90 a 90</div>
            </div>

            <div cCol sm="6">
              <label cLabel for="longitude">Longitud GPS</label>
              <input
                cFormControl
                id="longitude"
                type="number"
                formControlName="longitude"
                placeholder="Ej: -77.5278"
                step="0.0001"
                [class.is-invalid]="isInvalid('longitude')"
              />
              @if (isInvalid('longitude')) {
                <c-form-feedback [valid]="false">{{ getError('longitude') }}</c-form-feedback>
              }
              <div class="form-text">Rango: -180 a 180</div>
            </div>
          </div>

        </form>
      </c-card-body>

      <!-- FOOTER CON BOTONES -->
      <c-card-footer class="d-flex justify-content-end gap-2">
        <button
          cButton
          color="secondary"
          variant="outline"
          [disabled]="loading"
          (click)="onCancel()">
          Cancelar
        </button>
        
        <button
          cButton
          color="primary"
          [disabled]="loading || form.invalid"
          (click)="onSubmit()">
          @if (loading) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Guardando...
          } @else {
            <c-icon name="cilCheckCircle" class="me-2"></c-icon>
            Guardar Cambios
          }
        </button>
      </c-card-footer>
    </c-card>

    <!-- NOTA INFORMATIVA -->
    <c-alert color="info" class="mt-4">
      <c-icon name="cilInfo" class="me-2"></c-icon>
      <strong>Nota:</strong> Solo se puede editar la información básica del parqueo.
      Para modificar zonas, espacios o configuraciones, accede a las secciones específicas desde el detalle del parqueo.
    </c-alert>

  }

</div>