<!-- Reset Password Form - Diseño Futurista -->
<div class="reset-container">
  
  <!-- Header -->
  <div class="form-header">
    <div class="icon-container">
      <i class="fas fa-lock-open"></i>
      <div class="icon-glow"></div>
    </div>
    <h2>Restablecer Contraseña</h2>
    <p class="subtitle">Ingresa tu nueva contraseña para acceder a tu cuenta</p>
  </div>

  <!-- Success Alert -->
  @if (successMessage) {
    <app-alert-message 
      type="success" 
      [message]="successMessage"
      [dismissible]="true"
      (onDismiss)="dismissSuccess()">
    </app-alert-message>
  }

  <!-- Error Alert -->
  @if (errorMessage) {
    <app-alert-message 
      type="error" 
      [message]="errorMessage"
      [dismissible]="true"
      (onDismiss)="dismissError()">
    </app-alert-message>
  }

  <!-- Reset Password Form -->
  @if (tokenValid) {
    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
      
      <!-- Password Field -->
      <div class="form-group">
        <label for="password" style="color: white;">
          <i class="fas fa-lock"></i>
          Nueva Contraseña
        </label>
        <div class="input-wrapper">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            class="form-control"
            [class.error]="hasError('password', 'required') || hasError('password', 'minlength') || hasError('password', 'pattern')"
            formControlName="password"
            placeholder="••••••••"
            autocomplete="new-password"
            autofocus>
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility('password')">
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
          <div class="input-border"></div>
        </div>
        @if (hasError('password', 'required') || hasError('password', 'minlength') || hasError('password', 'pattern')) {
          <span class="error-message">{{ getErrorMessage('password') }}</span>
        }
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirmPassword" style="color: white;">
          <i class="fas fa-lock"></i>
          Confirmar Nueva Contraseña
        </label>
        <div class="input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            class="form-control"
            [class.error]="hasError('confirmPassword', 'required') || hasPasswordMismatch()"
            formControlName="confirmPassword"
            placeholder="••••••••"
            autocomplete="new-password">
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility('confirmPassword')">
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
          <div class="input-border"></div>
        </div>
        @if (hasPasswordMismatch()) {
          <span class="error-message">Las contraseñas no coinciden</span>
        }
      </div>

      <!-- Password Requirements Info -->
      <div class="password-requirements">
        <i class="fas fa-info-circle"></i>
        <span>La contraseña debe tener mínimo 8 caracteres, incluir mayúsculas, minúsculas, números y caracteres especiales (@$!%*?&)</span>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn-submit"
        [disabled]="isLoading">
        @if (!isLoading) {
          <span class="btn-content">
            <i class="fas fa-check"></i>
            <span>Restablecer Contraseña</span>
          </span>
        } @else {
          <span class="btn-content">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Restableciendo...</span>
          </span>
        }
        <div class="btn-glow"></div>
      </button>

    </form>
  } @else {
    <!-- Invalid Token State -->
    <div class="invalid-token-state">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Link Inválido o Expirado</h3>
      <p>El link de recuperación ha expirado o es inválido. Por favor, solicita uno nuevo.</p>
      
      <!-- Request New Link Button -->
      <a routerLink="/forgot-password" class="btn-new-link">
        <i class="fas fa-redo"></i>
        <span>Solicitar Nuevo Link</span>
      </a>
    </div>
  }

  <!-- Divider -->
  <div class="divider">
    <span>¿Recordaste tu contraseña?</span>
  </div>

  <!-- Back to Login Link -->
  <a routerLink="/login" class="link-back">
    <i class="fas fa-arrow-left"></i>
    <span>Volver al Login</span>
  </a>

</div>