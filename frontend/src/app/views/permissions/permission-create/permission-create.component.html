<div class="permission-create-container">
  
  <!-- Header -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <h2 class="page-title mb-1">
          <i class="fas fa-key me-2"></i>
          Crear Nuevo Permiso
        </h2>
        <p class="text-muted mb-0">Define un nuevo permiso para el control de acceso</p>
      </div>
      
      <button 
        class="btn btn-outline-secondary"
        (click)="cancel()"
        [disabled]="isLoading">
        <i class="fas fa-times me-2"></i>
        Cancelar
      </button>
    </div>
  </div>

  <!-- Error Message -->
  @if (errorMessage) {
    <app-alert-message 
      type="error" 
      [message]="errorMessage"
      [dismissible]="true"
      (onDismiss)="dismissError()">
    </app-alert-message>
  }

  <!-- Info Alert -->
  <app-alert-message 
    type="info" 
    [message]="' El nombre del permiso se generar谩 autom谩ticamente en formato: m贸dulo.acci贸n (ej: users.create)'"
    [dismissible]="false">
  </app-alert-message>

  <form [formGroup]="permissionForm" (ngSubmit)="onSubmit()">
    
    <!-- Configuraci贸n del Permiso -->
    <div class="card mb-4">
      <div class="card-header">
        <strong>
          <i class="fas fa-cog me-2"></i>
          Configuraci贸n del Permiso
        </strong>
      </div>
      <div class="card-body">
        <div class="row g-3">
          
          <!-- M贸dulo -->
          <div class="col-md-6">
            <label for="module" class="form-label fw-semibold">
              <i class="fas fa-folder me-2"></i>
              M贸dulo <span class="text-danger">*</span>
            </label>
            <select
              id="module"
              class="form-select"
              formControlName="module"
              [class.is-invalid]="hasError('module', 'required')">
              <option value="">Selecciona un m贸dulo</option>
              @for (module of availableModules; track module.value) {
                <option [value]="module.value">
                  {{ module.label }}
                </option>
              }
            </select>
            
            @if (hasError('module', 'required')) {
              <div class="invalid-feedback">
                {{ getErrorMessage('module') }}
              </div>
            }
            
            <small class="form-text text-muted">
              Selecciona el m贸dulo al que pertenece el permiso
            </small>
          </div>

          <!-- Acci贸n -->
          <div class="col-md-6">
            <label for="action" class="form-label fw-semibold">
              <i class="fas fa-bolt me-2"></i>
              Acci贸n <span class="text-danger">*</span>
            </label>
            <select
              id="action"
              class="form-select"
              formControlName="action"
              [class.is-invalid]="hasError('action', 'required')">
              <option value="">Selecciona una acci贸n</option>
              @for (action of commonActions; track action.value) {
                <option [value]="action.value">
                  {{ action.label }}
                </option>
              }
              <option value="export">Exportar</option>
              <option value="import">Importar</option>
              <option value="restore">Restaurar</option>
              <option value="approve">Aprobar</option>
              <option value="reject">Rechazar</option>
            </select>
            
            @if (hasError('action', 'required')) {
              <div class="invalid-feedback">
                {{ getErrorMessage('action') }}
              </div>
            }
            
            <small class="form-text text-muted">
              Selecciona la acci贸n que se podr谩 realizar
            </small>
          </div>

          <!-- Nombre del Permiso (Auto-generado) -->
          <div class="col-12">
            <label for="name" class="form-label fw-semibold">
              <i class="fas fa-tag me-2"></i>
              Nombre del Permiso <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              id="name"
              class="form-control"
              formControlName="name"
              placeholder="Ej: users.create"
              (input)="onNameManualChange($event)"
              [class.is-invalid]="hasError('name', 'required') || hasError('name', 'minlength') || hasError('name', 'maxlength')">
            
            @if (hasError('name', 'required') || hasError('name', 'minlength') || hasError('name', 'maxlength')) {
              <div class="invalid-feedback">
                {{ getErrorMessage('name') }}
              </div>
            }
            
            <small class="form-text text-muted">
              Este nombre se genera autom谩ticamente, pero puedes editarlo si es necesario
            </small>
          </div>

          <!-- Descripci贸n -->
          <div class="col-12">
            <label for="description" class="form-label fw-semibold">
              <i class="fas fa-align-left me-2"></i>
              Descripci贸n
            </label>
            <textarea
              id="description"
              class="form-control"
              formControlName="description"
              rows="3"
              placeholder="Ej: Permite crear nuevos usuarios en el sistema"
              [class.is-invalid]="hasError('description', 'maxlength')">
            </textarea>
            
            @if (hasError('description', 'maxlength')) {
              <div class="invalid-feedback">
                {{ getErrorMessage('description') }}
              </div>
            }
            
            <small class="form-text text-muted">
              Descripci贸n clara de lo que permite hacer este permiso
            </small>
          </div>

          <!-- Estado -->
          <div class="col-md-6">
            <label for="status" class="form-label fw-semibold">
              <i class="fas fa-power-off me-2"></i>
              Estado
            </label>
            <select id="status" class="form-select" formControlName="status">
              <option [value]="true">Activo</option>
              <option [value]="false">Inactivo</option>
            </select>
            <small class="form-text text-muted">
              Solo los permisos activos se aplican a los roles
            </small>
          </div>

        </div>
      </div>
    </div>

    <!-- Preview del Permiso -->
    @if (permissionForm.get('name')?.value) {
      <div class="card mb-4">
        <div class="card-header">
          <strong>
            <i class="fas fa-eye me-2"></i>
            Vista Previa del Permiso
          </strong>
        </div>
        <div class="card-body">
          <div class="permission-preview">
            <div class="preview-item">
              <span class="preview-label">Nombre:</span>
              <code class="preview-value">{{ permissionForm.get('name')?.value }}</code>
            </div>
            
            @if (permissionForm.get('description')?.value) {
              <div class="preview-item">
                <span class="preview-label">Descripci贸n:</span>
                <span class="preview-value">{{ permissionForm.get('description')?.value }}</span>
              </div>
            }
            
            <div class="preview-item">
              <span class="preview-label">M贸dulo:</span>
              <span class="badge bg-secondary">
                {{ permissionForm.get('module')?.value || 'Sin m贸dulo' }}
              </span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Estado:</span>
              @if (permissionForm.get('status')?.value) {
                <span class="badge bg-success">
                  <i class="fas fa-check-circle me-1"></i>
                  Activo
                </span>
              } @else {
                <span class="badge bg-danger">
                  <i class="fas fa-times-circle me-1"></i>
                  Inactivo
                </span>
              }
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Actions -->
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-end gap-2">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancel()"
            [disabled]="isLoading">
            <i class="fas fa-times me-2"></i>
            Cancelar
          </button>

          <button
            type="submit"
            class="btn btn-success"
            [disabled]="isLoading || permissionForm.invalid">
            @if (isLoading) {
              <span class="spinner-border spinner-border-sm me-2"></span>
              Creando...
            } @else {
              <i class="fas fa-save me-2"></i>
              Crear Permiso
            }
          </button>
        </div>
      </div>
    </div>

  </form>

</div>