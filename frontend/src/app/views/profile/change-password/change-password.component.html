<!-- Change Password Form - Diseño Futurista -->
<div class="change-password-container">
  
  <!-- Header -->
  <div class="form-header">
    <div class="icon-container">
      <i class="fas fa-shield-alt"></i>
      <div class="icon-glow"></div>
    </div>
    <h2>Cambiar Contraseña</h2>
    <p class="subtitle">Actualiza tu contraseña para mantener tu cuenta segura</p>
  </div>

  <!-- Success Alert -->
  @if (successMessage) {
    <app-alert-message 
      type="success" 
      [message]="successMessage"
      [dismissible]="true"
      (onDismiss)="dismissSuccess()">
    </app-alert-message>
  }

  <!-- Error Alert -->
  @if (errorMessage) {
    <app-alert-message 
      type="error" 
      [message]="errorMessage"
      [dismissible]="true"
      (onDismiss)="dismissError()">
    </app-alert-message>
  }

  <!-- Change Password Form -->
  <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
    
    <!-- Current Password Field -->
    <div class="form-group">
      <label for="currentPassword">
        <i class="fas fa-lock"></i>
        Contraseña Actual
      </label>
      <div class="input-wrapper">
        <input
          [type]="showCurrentPassword ? 'text' : 'password'"
          id="currentPassword"
          class="form-control"
          [class.error]="hasError('currentPassword', 'required')"
          formControlName="currentPassword"
          placeholder="Ingresa tu contraseña actual"
          autocomplete="current-password">
        <button 
          type="button" 
          class="toggle-password"
          (click)="togglePasswordVisibility('current')"
          tabindex="-1">
          <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
        <div class="input-border"></div>
      </div>
      @if (hasError('currentPassword', 'required')) {
        <span class="error-message">{{ getErrorMessage('currentPassword') }}</span>
      }
    </div>

    <!-- New Password Field -->
    <div class="form-group">
      <label for="newPassword">
        <i class="fas fa-key"></i>
        Nueva Contraseña
      </label>
      <div class="input-wrapper">
        <input
          [type]="showNewPassword ? 'text' : 'password'"
          id="newPassword"
          class="form-control"
          [class.error]="hasError('newPassword', 'required') || hasError('newPassword', 'minlength') || hasError('newPassword', 'pattern')"
          formControlName="newPassword"
          placeholder="Ingresa tu nueva contraseña"
          autocomplete="new-password">
        <button 
          type="button" 
          class="toggle-password"
          (click)="togglePasswordVisibility('new')"
          tabindex="-1">
          <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
        <div class="input-border"></div>
      </div>
      @if (hasError('newPassword', 'required') || hasError('newPassword', 'minlength') || hasError('newPassword', 'pattern')) {
        <span class="error-message">{{ getErrorMessage('newPassword') }}</span>
      }
    </div>

    <!-- Confirm Password Field -->
    <div class="form-group">
      <label for="confirmPassword">
        <i class="fas fa-check-circle"></i>
        Confirmar Nueva Contraseña
      </label>
      <div class="input-wrapper">
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          id="confirmPassword"
          class="form-control"
          [class.error]="hasError('confirmPassword', 'required') || hasPasswordMismatch()"
          formControlName="confirmPassword"
          placeholder="Confirma tu nueva contraseña"
          autocomplete="new-password">
        <button 
          type="button" 
          class="toggle-password"
          (click)="togglePasswordVisibility('confirm')"
          tabindex="-1">
          <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
        <div class="input-border"></div>
      </div>
      @if (hasError('confirmPassword', 'required')) {
        <span class="error-message">{{ getErrorMessage('confirmPassword') }}</span>
      }
      @if (hasPasswordMismatch()) {
        <span class="error-message">Las contraseñas no coinciden</span>
      }
    </div>

    <!-- Password Requirements Info -->
    <div class="info-box">
      <i class="fas fa-info-circle"></i>
      <span>
        La contraseña debe tener mínimo 8 caracteres, incluir mayúsculas, minúsculas, 
        números y caracteres especiales (@$!%*?&)
      </span>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <!-- Submit Button -->
      <button
        type="submit"
        class="btn-submit"
        [disabled]="isLoading || changePasswordForm.invalid">
        @if (!isLoading) {
          <span class="btn-content">
            <i class="fas fa-save"></i>
            <span>Cambiar Contraseña</span>
          </span>
        } @else {
          <span class="btn-content">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Guardando...</span>
          </span>
        }
        <div class="btn-glow"></div>
      </button>

      <!-- Cancel Button -->
      <button
        type="button"
        class="btn-cancel"
        (click)="cancel()"
        [disabled]="isLoading">
        <i class="fas fa-times"></i>
        <span>Cancelar</span>
      </button>
    </div>

  </form>

  <!-- Security Info -->
  <div class="security-info">
    <i class="fas fa-shield-check"></i>
    <span>Por seguridad, deberás iniciar sesión nuevamente después de cambiar tu contraseña</span>
  </div>

</div>